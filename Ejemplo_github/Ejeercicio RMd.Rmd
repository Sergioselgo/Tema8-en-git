---
title: |
  "Informe NILs"
  ![](Logo_UCO (1).png){width="15%"}
  ![](Logotipo_I_Facultad_de_Ciencias_Fondo_blanco_negativo.png){width="15%"}
author: "Sergio Selma González, b22segos@gmail.com"
date: "`r Sys.Date()`"
output: 
  html_document: 
    toc: TRUE   #para el índice de contenidos 
    number_sections: TRUE
bibliography: ["zotero.bib", "libraries.bib"]
link-citations: true #para que las citas en el texto se conviertan en enlaces 
---

```{r setup, include=FALSE}
# lo de incluce = false significa que ni el código ni el resultado del chunk se mostrarán en el documento final 
knitr::opts_chunk$set(echo = TRUE)
# Esto ajusta la configuración global de todos los chunks de R del documento. hace que no salgan los mensajes que generan las librerias cuando se cargan 
```

# Introducción

## Trabajo seleccionado

Vamos a trabajar con los datos de [@perez2024phenotypic]. Este trabajo describe [genes candidatos]{Style="color:green"} de la floración en [garbanzo]{Stlye="color:red" style="color: red"}(Cicer arietinum) como MED16, BBX24 o ELF3, este último también reportado por otros estudios como [@ridge_chickpea_2017]. Los mecanismos básicos de floración estudiados en la planta modelo Arabidopsis thaliana están conservados en las leguminosas [@weller_genetic_2019], [@hecht_conservation_2005], [@weller_genetic_2015]), exceptuando ciertos genes como CONSTANS [@wong_isolation_2014] \`\`\`

## Los datos

[link donde se puede encontrar el trabajo original](https://bmcplantbiol.biomedcentral.com/articles/10.1186/s12870-024-05411-y "link donde se puede encontrar el trabajo original")

```{r echo=FALSE, message=FALSE, warning=FALSE}
library('dplyr')
library('ggplot2')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(readxl)
Data1 <- read_excel("C:/Users/sergi/OneDrive/Escritorio/Computación/Ejercicio RMd/12870_2024_5411_MOESM1_ESM (1).xlsx",
                   skip=1)
```

```{r vista-datos, echo=FALSE}
knitr::kable(head(Data1, 8), align = 'c', caption = "tabla 1: ocho primeras filas")
# knitr::kable() sirve para crear una tabla en el formato adecuado.
# head(Data1, 8) sirve para que del Data1 me muestre sólo las 8 primeras líneas.
# align = "c" es para que las columnas estén alineadas en el centro, para izquierda.
```

Los datos tienen `r nrow(Data1)` filas y `r ncol(Data1)` columnas.

```{r 6.a, echo=FALSE}
Data1 <- Data1 %>% filter(CHROM %in% c("NC_021160.1","NC_021161.1",
"NC_021162.1", "NC_021163.1", "NC_021164.1",
"NC_021165.1","NC_021166.1", "NC_021167.1"))
```

Del total de SNPs detectados, `r nrow(Data1)` se corresponden con SNPs situados en cromosomas.

```{r}
Cromosoma <- Data1 %>% count(CHROM) %>% arrange(desc(n))

```

```{r gráfica-densidad-cromosomal, echo=FALSE, fig.align='center', fig.cap="Figura 1: Densidad de variantes en *cromosoma 1*", out.width='60%'}

Cromosoma %>% 
  ggplot(aes(x = CHROM, y = n)) +
  geom_bar(stat = "identity") +
  labs(x = "Cromosoma", y = "Número de SNP",
       y = "Densidad")
```

## Hipótesis

Los cromosomas con mayor número de SNPs presentan mayor % de SNPs que no pasan el filtro de calidad

# Materiales y métodos

Para llevar a cabo el análisis, usaremos R [@R-base], dplyr [@R-dplyr], ggplot2 [@R-ggplot2]

# Resultados

```{r echo=FALSE, message=FALSE, warning=FALSE}

 Data1_filtrado <- Data1 %>% 
  select(CHROM, POS, FILTER)
 
```

En **CHROM** aparecen los diferentes cromosomas del [garbanzo]{style="color: red"}, en POS aparecen las posiciones de los SNPs detectados y en FILTER aparece el filtro de calidad. Los SNPs que pasan el filtro aparecen descritos como PASS.

```{r echo=FALSE, message=FALSE, warning=FALSE}
Data1_filtradoNP <- Data1 %>%
  dplyr::mutate(
    NewFilter = ifelse(FILTER == "PASS", "PASS", "NOT_PASS")
  )

  
```

## Cálculo de porcentajes por cromosoma

```{r resumen_snp, include=FALSE}
resumen <- Data1_filtradoNP %>% 
  group_by(CHROM) %>% 
  summarise(
    total_snp = n(),
    not_pass = sum(NewFilter == "NOT_PASS"),
    porcentaje_notpass = round((not_pass / total_snp) * 100, 1)
  )
```

```{r mostrar_tabla}
knitr::kable(resumen, caption = "Tabla 2.
Porcentaje de SNPs que pasan y no pasan el filtro por cromosoma")  
```

```{r gráfico_dispersión}
library(ggplot2)

ggplot(resumen, aes(x= total_snp, y = porcentaje_notpass)) +
  geom_point(color = "steelblue") +     # Puntos
  geom_smooth(method = "lm", se = TRUE, color = "red") + # Línea de tendencia
  labs(title = "Relación entre número total de SNPs y porcentaje que pasa el filtro",
       x = "Total de SNPs por cromosoma",
       y = "Porcentaje de SNPs filtrados correctamente"
  )
```
